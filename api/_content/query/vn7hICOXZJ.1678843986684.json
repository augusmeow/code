{"_path":"/code/sys-design/design-pattern","_dir":"sys-design","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"设计模式","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"设计模式"},"children":[{"type":"text","value":"设计模式"}]},{"type":"element","tag":"h2","props":{"id":"单例模式的双锁分别有什么作用"},"children":[{"type":"text","value":"单例模式的双锁分别有什么作用"}]},{"type":"element","tag":"h2","props":{"id":"实现单例设计模式懒汉饿汉"},"children":[{"type":"text","value":"实现单例设计模式（懒汉，饿汉）"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/a/92193/17744936","rel":["nofollow"]},"children":[{"type":"text","value":"singleton-how-should-it-be-used"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"意图：保证一个类仅有一个实例，并提供一个访问他的全局访问点。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"主要解决：一个全局使用的类频繁的创建与销毁。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"何时使用：当您想控制实例数目节省系统资源的时候。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如何解决：判断系统是否已经有这个单例，如果有则返回，如果没有则创建。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"关键代码：构造函数是私有的。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"饿汉：在类加载时就创建实例；懒汉：在第一次使用时进行实例化"}]},{"type":"element","tag":"callout","props":{},"children":[{"type":"element","tag":"template","props":{"v-slot:summary":""},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"code"}]}]},{"type":"element","tag":"template","props":{"v-slot:content":""},"children":[{"type":"element","tag":"code","props":{"code":"class Singleton\n{\nprivate:\nstatic Singleton instance;\nprivate:\nSingleton();\n~Singleton();\nSingleton(const Singleton&);\nSingleton& operator=(const Singleton&);\npublic:\nstatic Singleton& getInstance() {\nreturn instance;\n}\n}\n\n// initialize defaultly\nSingleton Singleton::instance;\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"private:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" Singleton instance;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"private:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"~Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"operator"}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"public:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"getInstance"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"() {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" instance;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-c1b5da"},"children":[{"type":"text","value":"// initialize defaultly"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"Singleton "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"::instance;"}]}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"简述常见的工厂模式以及单例模式的使用场景"},"children":[{"type":"text","value":"简述常见的工厂模式以及单例模式的使用场景"}]},{"type":"element","tag":"h2","props":{"id":"如何实现单例模式如何避免发生对象的用户复制行为如何实现线程安全的单例模式dclp是什么有什么问题"},"children":[{"type":"text","value":"如何实现单例模式？如何避免发生对象的用户复制行为？如何实现线程安全的单例模式？DCLP是什么，有什么问题？"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"将构造函数、析构函数、复制构造函数、赋值操作符声明为私有，即可实现单例模式\n单例模式实现代码通常为："},{"type":"element","tag":"code","props":{"code":"class Singleton\n{\npublic:\n    static Singleton* Instance();\nprotected:\n    Singleton();\nprivate:\n    static Singleton* _instance;\n};\nSingleton::Singleton(){}\nSingleton* Singleton::_instance = nullptr;\nSingleton* Singleton::Instance()\n{\n    if(_instance == nullptr)\n    _instance = new Singleton;\n    return _instance;\n}\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"public:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"Instance"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"protected:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"private:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" _instance;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"};"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"(){}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"::_instance "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2065c4"},"children":[{"type":"text","value":"nullptr"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2a99b2"},"children":[{"type":"text","value":"Singleton"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-ebcaf3"},"children":[{"type":"text","value":"Instance"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"(_instance "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2065c4"},"children":[{"type":"text","value":"nullptr"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"    _instance "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" Singleton;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-1d2712"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":" _instance;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-24c2cf"},"children":[{"type":"text","value":"}"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"避免用户的复制行为，可以将复制构造函数声明为private或者使用C++11中的delete语法。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"实现线程安全的单例模式：上面实现中的GetInstance()不是线程安全的，因为在单例的静态初始化中存在竞争条件。如果碰巧有多个线程在同时调用该方法，那么就有可能被构造多次。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"比较简单"}]},{"type":"text","value":"的做法是在存在竞争条件的地方加上互斥锁。这样做的代价是开销比较高。因为每次方法调用时都需要加锁。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"比较常用"}]},{"type":"text","value":"的做法是使用双重检查锁定模式(DCLP)\n。但是DCLP并不能保证在所有编译器和处理器内存模型下都能正常工作。如，共享内存的对称多处理器通常突发式提交内存写操作，这会造成不同线程的写操作重新排序。这种情况通常可以采用volatile解决，他能将读写操作同步到易变数据中，但这样在多线程环境下仍旧存在问题。"}]}]},{"type":"element","tag":"pdf","props":{"url":"/pdf/DDJ_Jul_Aug_2004_revised.pdf"},"children":[{"type":"element","tag":"h2","props":{"id":"手写生产者消费者模型"},"children":[{"type":"text","value":"手写生产者消费者模型"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-2065c4{color:#0550AE}\n.ct-c1b5da{color:#6E7781}\n.ct-ebcaf3{color:#8250DF}\n.ct-2a99b2{color:#953800}\n.ct-24c2cf{color:#24292F}\n.ct-1d2712{color:#CF222E}\n.dark .ct-1d2712{color:#FF7B72}\n.dark .ct-24c2cf{color:#C9D1D9}\n.dark .ct-2a99b2{color:#FFA657}\n.dark .ct-ebcaf3{color:#D2A8FF}\n.dark .ct-c1b5da{color:#8B949E}\n.dark .ct-2065c4{color:#79C0FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"单例模式的双锁分别有什么作用","depth":2,"text":"单例模式的双锁分别有什么作用"},{"id":"实现单例设计模式懒汉饿汉","depth":2,"text":"实现单例设计模式（懒汉，饿汉）"},{"id":"简述常见的工厂模式以及单例模式的使用场景","depth":2,"text":"简述常见的工厂模式以及单例模式的使用场景"},{"id":"如何实现单例模式如何避免发生对象的用户复制行为如何实现线程安全的单例模式dclp是什么有什么问题","depth":2,"text":"如何实现单例模式？如何避免发生对象的用户复制行为？如何实现线程安全的单例模式？DCLP是什么，有什么问题？"},{"id":"手写生产者消费者模型","depth":2,"text":"手写生产者消费者模型"}]}},"_type":"markdown","_id":"content:3.code:sys-design:design-pattern.md","_source":"content","_file":"3.code/sys-design/design-pattern.md","_extension":"md"}