{"_path":"/cpp/thread-mutex/threads-and-mutexes","_dir":"thread-mutex","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Threads and Mutexes","description":"from stanford edu CS110 Lecture 10: Threads and Mutexes","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"threads-and-mutexes"},"children":[{"type":"text","value":"Threads and Mutexes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"from "},{"type":"element","tag":"a","props":{"href":"https://web.stanford.edu/class/archive/cs/cs110/cs110.1204/static/lectures/10-threads-and-mutexes.pdf","rel":["nofollow"]},"children":[{"type":"text","value":"stanford"}]},{"type":"text","value":" edu "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"CS110 Lecture 10: Threads and Mutexes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"CS110 Lecture 10: Threads and Mutexes"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Principles of Computer Systems"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWinter 2020\nStanford University\nComputer Science Department"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Instructors"}]},{"type":"text","value":": Chris Gregg and Nick Troccoli"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"CS110 Topic 3"}]},{"type":"text","value":": How can we have concurrency within a single process?"}]},{"type":"element","tag":"h2","props":{"id":"learning-about-processes"},"children":[{"type":"text","value":"Learning About Processes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/stanford/process.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"todays-learning-goals"},"children":[{"type":"text","value":"Today's Learning Goals"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Discover some of the pitfalls of threads sharing the same virtual address space"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Learn how locks can help us limit access to shared resources"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get practice using condition variables to wait for signals from other threads"}]}]},{"type":"element","tag":"h2","props":{"id":"plan-for-today"},"children":[{"type":"text","value":"Plan For Today"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Recap:"}]},{"type":"text","value":" Threads in C++"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Races When Accessing Shared Data"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Introducing Mutexes"}]}]},{"type":"element","tag":"h3","props":{"id":"recap-threads-in-c"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Recap:"}]},{"type":"text","value":" Threads in C++"}]},{"type":"element","tag":"h4","props":{"id":"threads"},"children":[{"type":"text","value":"Threads"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"thread"}]},{"type":"text","value":" is an independent execution sequence within a single process."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Most common: assign each thread to execute a single function in parallel"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Each thread operates within the same process, so they "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"share global data"}]},{"type":"text","value":"(!) (text, data, and heap segments)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"They each have their own stack (e.g. for calls within a single thread)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Execution alternates between threads as it does for processes"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Many similarities between threads and processes; in fact, threads are often called "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"lightweight processes"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"h4","props":{"id":"threads-vs-processes"},"children":[{"type":"text","value":"Threads vs. Processes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Processes:"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"isolate virtual address spaces (good: security and stability, bad: harder to share info)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"can run external programs easily (fork-exec) (good)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"harder to coordinate multiple tasks within the same program (bad)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Threads:"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"share virtual address space (bad: security and stability, good: easier to share info)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"can't run external programs easily (bad)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"easier to coordinate multiple tasks within the same program (good)"}]}]},{"type":"element","tag":"h4","props":{"id":"c-thread"},"children":[{"type":"text","value":"C++ "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"thread"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A thread object can be spawned to run the specified function with the given arguments."}]},{"type":"element","tag":"code","props":{"code":"thread myThread(myFunc, arg1, arg2, ...);\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"myThread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"myFunc"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"arg1"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"arg2"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", ...);"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"**myFunc:**the function the thread should execute asynchronously"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"**args:**a list of arguments (any length, or none) to pass to the function upon execution"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Once initialized with this constructor, the thread may execute at any time!"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To pass objects by reference to a thread, use the **ref()**function:"}]},{"type":"element","tag":"code","props":{"code":"void myFunc(int& x, int& y) {...}\n\nthread myThread(myFunc, ref(arg1), ref(arg2));\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"myFunc"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"int&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"int&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {...}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"myThread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"myFunc"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(arg1), "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(arg2));"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can make an array of threads as follows:"}]},{"type":"element","tag":"code","props":{"code":"// declare array of empty thread handles \nthread friends[5]; \n\n// Spawn threads\nfor (size_t i = 0; i < 5; i++) {\n    friends[i] = thread(myFunc, arg1, arg2); \n}\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"// declare array of empty thread handles "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"thread friends["}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"]; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"// Spawn threads"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    friends[i] "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(myFunc, arg1, arg2); "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can also initialize an array of threads as follows (note the loop by reference):"}]},{"type":"element","tag":"code","props":{"code":"thread friends[5]; \nfor (thread& currFriend : friends) {\n    currFriend = thread(myFunc, arg1, arg2); \n}  \n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"thread friends["}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"]; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" (thread"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" currFriend : friends) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    currFriend "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(myFunc, arg1, arg2); "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}  "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To wait on a thread to finish, use the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":".join()"}]},{"type":"text","value":" method:"}]},{"type":"element","tag":"code","props":{"code":"thread myThread(myFunc, arg1, arg2); \n\n... // do some work\n\n// Wait for thread to finish (blocks) \nmyThread.join();\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"myThread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"myFunc"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"arg1"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"arg2"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"); "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"..."}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":" // do some work"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"// Wait for thread to finish (blocks) "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"myThread."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For multiple threads, we must wait on a specific thread one at a time:"}]},{"type":"element","tag":"code","props":{"code":"thread friends[5]; \n// spawn here\n// now we wait for each to finish \nfor (size_t i = 0; i < 5; i++) { \n    friends[i].join(); \n} \n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"thread friends["}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"]; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"// spawn here"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"// now we wait for each to finish "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") { "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    friends[i]."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(); "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"} "}]}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"thread-safety"},"children":[{"type":"text","value":"Thread Safety"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"thread-safe"}]},{"type":"text","value":"function is one that will always execute correctly, even when called concurrently from multiple threads."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":"is thread-safe, but **operator<<**is "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"not"}]},{"type":"text","value":". This means e.g. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"cout"}]},{"type":"text","value":" statements could get interleaved!"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"To avoid this, use "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"oslock"}]},{"type":"text","value":"and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"osunlock"}]},{"type":"text","value":"(custom CS110 functions - "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"#include \"ostreamlock.h\""}]},{"type":"text","value":") around streams. They ensure at most one thread has permission to write into a stream at any one time."}]}]},{"type":"element","tag":"code","props":{"code":"cout << oslock <<  \"Hello, world!\" <<  endl << osunlock;\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" oslock "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Hello, world!\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"  endl "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" osunlock;"}]}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"threads-share-memory"},"children":[{"type":"text","value":"Threads Share Memory"}]},{"type":"element","tag":"code","props":{"code":"static void greeting(size_t& i) {\n    cout << oslock << \"Hello, world! I am thread \" << i << endl << osunlock; \n}\n\nstatic const size_t kNumFriends = 6;\nint main(int argc, char *argv[]) {\n    cout << \"Let's hear from \" << kNumFriends << \" threads.\" << endl;\n\n    thread friends[kNumFriends]; // declare array of empty thread handles\n\n    // Spawn threads\n    for (size_t i = 0; i < kNumFriends; i++) {\n        friends[i] = thread(greeting, ref(i));\n    }\n\n    // Wait for threads\n    for (size_t i = 0; i < kNumFriends; i++) {\n    friends[i].join();\n    }\n\n    cout << \"Everyone's said hello!\" << endl;\n    return 0;\n}\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"greeting"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"i"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" oslock "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Hello, world! I am thread \""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" osunlock; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" kNumFriends "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"argc"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"char"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"argv"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"[]) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Let's hear from \""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" kNumFriends "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" threads.\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    thread friends[kNumFriends];"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":" // declare array of empty thread handles"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"    // Spawn threads"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" kNumFriends; i"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        friends[i] "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(greeting, "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(i));"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"    // Wait for threads"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" kNumFriends; i"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    friends[i]."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Everyone's said hello!\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Output"}]},{"type":"element","tag":"code","props":{"code":"$ ./friends\nLet's hear from 6 threads.\nHello, world! I am thread 2 \nHello, world! I am thread 2 \nHello, world! I am thread 3 \nHello, world! I am thread 5 \nHello, world! I am thread 5 \nHello, world! I am thread 6 \nEveryone's said hello!\n","language":"shell","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"./friends"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Let's"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"hear"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"threads."}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Hello,"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"world!"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"I"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"am"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Hello,"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"world!"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"I"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"am"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Hello,"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"world!"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"I"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"am"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Hello,"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"world!"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"I"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"am"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Hello,"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"world!"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"I"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"am"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Hello,"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"world!"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"I"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"am"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"Everyone's"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"said"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"hello!"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"for ( size_t i =  0; i < kNumFriends; i++) {\n    friends[i].join();    \n}\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ( "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" kNumFriends; i"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    friends[i]."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();    "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/stanford/threads_share_memory.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Solution"}]},{"type":"text","value":": pass a copy of i (not by reference) so it does not change."}]},{"type":"element","tag":"h3","props":{"id":"races-when-accessing-shared-data"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Races When Accessing Shared Data"}]}]},{"type":"element","tag":"h4","props":{"id":"thread-level-parallelism"},"children":[{"type":"text","value":"Thread-Level Parallelism"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Threads allow a process to parallelize a problem across multiple cores"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Consider a scenario where we want to process 250 images and have 10 cores"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Simulation"}]},{"type":"text","value":": let each thread help process images until none are left"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Let's jump to a demo to see how this works"}]}]},{"type":"element","tag":"code","props":{"code":"int main(int argc, const char *argv[]) { \n    thread processors[10]; \n    size_t remainingImages = 250; \n    for (size_t i = 0; i < 10; i++)     \n        processors[i] = thread(process, 101 + i, ref(remainingImages));   \n    for (thread& proc: processors) proc.join();\n    cout << \"Images done!\" << endl; \n    return 0; \n}\n","filename":"images.cc","language":"cpp","meta":"[images.cc]"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"main"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"argc"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"char"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"argv"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"[]) { "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    thread processors["}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"]; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" remainingImages "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"250"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; i"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":")     "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        processors[i] "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"thread"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(process, "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"101"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" i, "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"ref"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(remainingImages));   "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" (thread"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" proc: processors) proc."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Images done!\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There is a "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"race condition"}]},{"type":"text","value":" here!"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"**Problem:**threads could interrupt each other in between lines 2 and 3."},{"type":"element","tag":"code","props":{"code":"static  void process(size_t id, size_t& remainingImages) { \n    while (remainingImages >  0) {  \n        sleep_for( 500 );   // simulate \"processing image\" \n        remainingImages--;\n        // ...    \n    }\n    //... \n}\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"process"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"remainingImages"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") { "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"while"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" (remainingImages "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {  "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"sleep_for"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"( "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"500"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" );"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"   // simulate \"processing image\" "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        remainingImages"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"--"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"        // ...    "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"    //... "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"**Why is this?**It's because "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages > 0"}]},{"type":"text","value":" test and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages--"}]},{"type":"text","value":" aren't atomic"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Atomicity: externally, the code has either executed or not; external observers do not see any intermediate states mid-execution"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If a thread evaluates "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages > 0"}]},{"type":"text","value":"to be "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"and commits to processing an image, another thread could come in and claim that same image before this thread processes it."}]}]},{"type":"element","tag":"h4","props":{"id":"why-test-and-decrement-is-really-not-thread-safe"},"children":[{"type":"text","value":"Why Test and Decrement Is REALLY NOT Thread-Safe"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"C++ statements aren't inherently atomic. Virtually all C++ statementseven ones as simple as "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages--"}]},{"type":"text","value":"compile to multiple assembly code instructions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Assembly code instructions are atomic, but C++ statements are not."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"g++"}]},{"type":"text","value":" on the myths compiles "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages--"}]},{"type":"text","value":" to five assembly code instructions, as with:"},{"type":"element","tag":"code","props":{"code":"0x0000000000401a9b <+36>:   mov    -0x20(%rbp),%rax\n0x0000000000401a9f <+40>:   mov    (%rax),%eax\n0x0000000000401aa1 <+42>:   lea    -0x1(%rax),%edx\n0x0000000000401aa4 <+45>:   mov    -0x20(%rbp),%rax\n0x0000000000401aa8 <+49>:   mov    %edx,(%rax)\n","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"0x0000000000401a9b <+36>:   mov    -0x20(%rbp),%rax\n0x0000000000401a9f <+40>:   mov    (%rax),%eax\n0x0000000000401aa1 <+42>:   lea    -0x1(%rax),%edx\n0x0000000000401aa4 <+45>:   mov    -0x20(%rbp),%rax\n0x0000000000401aa8 <+49>:   mov    %edx,(%rax)"}]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The first two lines drill through the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages"}]},{"type":"text","value":" reference to load a copy of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages"}]},{"type":"text","value":" held on "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"'s stack. The third line decrements that copy, and the last two write the decremented copy back to the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages"}]},{"type":"text","value":" variable held on "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"'s stack."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The ALU operates on registers, but registers are private to a core, so the variable needs to be loaded from and stored to memory."},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Each thread makes a local copy of the variable before operating on it"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"What if multiple threads all load the variable at the same time: they all think there's only 128 images remaining and process 128 at the same time"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"introducing-mutexes"},"children":[{"type":"text","value":"Introducing Mutexes"}]},{"type":"element","tag":"h4","props":{"id":"mutex"},"children":[{"type":"text","value":"Mutex"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A mutex is a variable type that represents something like a \"locked door\"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/stanford/locked_door.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"lock"}]},{"type":"text","value":"the door:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"if it's unlocked, you go through the door and lock it"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"if it's locked, you "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"wait for it to unlock first"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you most recently locked the door, you can "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"unlock"}]},{"type":"text","value":"the door:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"door is now unlocked, another may go in now"}]}]},{"type":"element","tag":"h4","props":{"id":"mutex-mutual-exclusion"},"children":[{"type":"text","value":"Mutex - Mutual Exclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A mutex is a type used to enforce "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"mutual exclusion"}]},{"type":"text","value":", i.e., a critical section"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mutexes are often called locks"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"To be very precise, mutexes are one kind of lock, there are others (read/write locks, reentrant locks, etc.), but we can just call them locks in this course, usually \"lock\" means \"mutex\""}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When a thread locks a mutex"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the lock is unlocked the thread takes the lock and continues execution"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the lock is locked, the thread blocks and waits until the lock is unlocked"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If multiple threads are waiting for a lock they all wait until lock is unlocked, one receives lock"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When a thread unlocks a mutex"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"It continues normally; one waiting thread (if any) takes the lock and is scheduled to run"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is a subset of the C++ mutex abstraction: nicely simple! How can we use this in our buggy program?"}]},{"type":"element","tag":"code","props":{"code":"class mutex {\npublic:\n    mutex();        // constructs the mutex to be in an unlocked state\n    void lock();    // acquires the lock on the mutex, blocking until it's unlocked\n    void unlock();  // releases the lock and wakes up another threads trying to lock it\n};\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"mutex"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"public:"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"mutex"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"        // constructs the mutex to be in an unlocked state"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"lock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"    // acquires the lock on the mutex, blocking until it's unlocked"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"unlock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"  // releases the lock and wakes up another threads trying to lock it"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"};"}]}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"critical-sections-with-mutexes"},"children":[{"type":"text","value":"Critical Sections With Mutexes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" instantiates a mutex, which it passes (by reference!) to invocations of "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"process."}]},{"type":"text","value":"\nThe "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"process"}]},{"type":"text","value":" code uses this lock to protect "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages"}]},{"type":"text","value":".\nNote we need to unlock on line 5 -- in complex code forgetting this is an easy bug"}]},{"type":"element","tag":"code","props":{"code":"static void process ( size_t id, size_t & remainingImages, mutex& counterLock) {\n    while ( true ) {\n        counterLock.lock();\n        if (remainingImages == 0) {\n            counterLock.unlock(); \n            break;\n        }\n        processImage(remainingImages);\n        remainingImages--;\n        cout << oslock << \"Thread#\" << id << \" processed an image (\" << remainingImages 11   << \" remain).\" << endl << osunlock;\n        counterLock.unlock();\n    }\n    cout << oslock << \"Thread#\" << id << \" sees no remaining images and exits.\" << endl << osunlock;\n}\n\n// Create single mutex in main, pass by reference\n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"process"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ( "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"size_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"remainingImages"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"mutex"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"counterLock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"while"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ( "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        counterLock."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"lock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" (remainingImages "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            counterLock."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"unlock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(); "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"break"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"processImage"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(remainingImages);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        remainingImages"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"--"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" oslock "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Thread#\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" id "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" processed an image (\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" remainingImages "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"11"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"   "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" remain).\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" osunlock;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        counterLock."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"unlock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" oslock "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Thread#\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" id "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" sees no remaining images and exits.\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" osunlock;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"// Create single mutex in main, pass by reference"}]}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"critical-sections-can-be-bottlenecks"},"children":[{"type":"text","value":"Critical Sections Can Be Bottlenecks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The way we've set it up, only one thread agent can process an image at a time!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We can do better: serialize deciding which image to process and parallelize the actual processing"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Keep your critical sections as small as possible!"}]},{"type":"element","tag":"code","props":{"code":"static void process ( size _t id, size _t & remainingImages, mutex& counterLock) { \n    while ( true ) {\n        size _t myImage; \n        \n        counterLock.lock();   // Start of critical section \n        if (remainingImages == 0) { \n            counterLock.unlock(); // Rather keep it here, easier to check \n            break;\n        } else { \n            myImage = remainingImages; \n            remainingImages--; \n            counterLock.unlock(); // end of critical section \n            \n            processImage(myImage); \n            cout << oslock << \"Thread#\" << id << \" processed an image (\" << remainingImages 16   << \" remain).\" << endl << osunlock; \n        } \n    } \n    cout << oslock << \"Thread#\" << id << \" sees no remaining images and exits.\" << endl << osunlock; \n} \n","language":"cpp","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"process"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ( "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"size"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"size"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"_t"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"remainingImages"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"mutex"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-8adf5e"},"children":[{"type":"text","value":"counterLock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") { "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"while"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ( "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" ) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        size _t myImage; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        counterLock."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"lock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":"   // Start of critical section "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" (remainingImages "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":") { "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            counterLock."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"unlock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":" // Rather keep it here, easier to check "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"break"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        } "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" { "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            myImage "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" remainingImages; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            remainingImages"}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"--"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            counterLock."}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"unlock"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"();"}]},{"type":"element","tag":"span","props":{"class":"ct-8580cb"},"children":[{"type":"text","value":" // end of critical section "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-60ed24"},"children":[{"type":"text","value":"processImage"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"(myImage); "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"            cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" oslock "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Thread#\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" id "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" processed an image (\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" remainingImages "}]},{"type":"element","tag":"span","props":{"class":"ct-594fbd"},"children":[{"type":"text","value":"16"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"   "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" remain).\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" osunlock; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"        } "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    } "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"    cout "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" oslock "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\"Thread#\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" id "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f5ee84"},"children":[{"type":"text","value":"\" sees no remaining images and exits.\""}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" endl "}]},{"type":"element","tag":"span","props":{"class":"ct-10afc3"},"children":[{"type":"text","value":"<<"}]},{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":" osunlock; "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-cd378a"},"children":[{"type":"text","value":"} "}]}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"problems-that-might-arise"},"children":[{"type":"text","value":"Problems That Might Arise"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What if "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"processImage"}]},{"type":"text","value":" can return an error?"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"E.g., what if we need to distinguish allocating an image and processing it"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A thread can grab the image by decrementing "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"remainingImages"}]},{"type":"text","value":" but if it fails there's no way for another thread to retry"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Because these are threads, if one thread has a SEGV the whole process will fail"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A more complex approach might be to maintain an actual queue of images and allow threads (in a critical section) to push things back into the queue"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What if image processing times are "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"highly"}]},{"type":"text","value":" variable (e.g, one image takes 100x as long as the others)?"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Might scan images to estimate execution time and try more intelligent scheduling"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What if there's a bug in your code, such that sometimes processImage randomly enters an infinite loop?"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Need a way to reissue an image to an idle thread"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"An infinite loop of course shouldn't occur, but when we get to networks sometimes execution time can vary by 100x for reasons outside our control"}]}]},{"type":"element","tag":"h4","props":{"id":"some-types-of-mutexes"},"children":[{"type":"text","value":"Some Types of Mutexes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Standard "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"mutex"}]},{"type":"text","value":": what we've seen"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If a thread holding the lock tries to re-lock it, deadlock"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"recursive_mutex"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A thread can lock the mutex multiple times, and needs to unlock it the same number of times to release it to other threads"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"timed_mutex"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A thread can "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"try_lock_for"}]},{"type":"text","value":" / "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"try_lock_until"}]},{"type":"text","value":": if time elapses, don't take lock"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Deadlocks if same thread tries to lock multiple times, like standard mutex"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this class, we'll focus on just regular "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"mutex"}]}]},{"type":"element","tag":"h4","props":{"id":"how-do-mutexes-work"},"children":[{"type":"text","value":"How Do Mutexes Work?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Something we've seen a few times is that you can't read and write a variable atomically"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"But a mutex does so! If the lock is unlocked, lock it"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How does this work with caches?"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Each core has its own cache"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Writes are typically write-back (write to higher cache level when line is evicted), not write-through (always write to main memory) for performance"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Caches are "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"coherent"}]},{"type":"text","value":" -- if one core writes to a cache line that is also in another core's cache, the other core's cache line is invalidated: this can become a performance problem"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hardware provides atomic memory operations, such as compare and swap"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"cas old, new, addr"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If addr == old, set addr to new"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Use this as a single bit to see if the lock is held and if not, take it"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If the lock is held already, then enqueue yourself (in a thread safe way) and tell kernel to sleep you"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When a node unlocks, it clears the bit and wakes up a thread"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-f5ee84{color:#0A3069}\n.ct-594fbd{color:#0550AE}\n.ct-8580cb{color:#6E7781}\n.ct-10afc3{color:#CF222E}\n.ct-60ed24{color:#8250DF}\n.ct-cd378a{color:#24292F}\n.ct-8adf5e{color:#953800}\n.dark .ct-8adf5e{color:#FFA657}\n.dark .ct-cd378a{color:#C9D1D9}\n.dark .ct-60ed24{color:#D2A8FF}\n.dark .ct-10afc3{color:#FF7B72}\n.dark .ct-8580cb{color:#8B949E}\n.dark .ct-594fbd{color:#79C0FF}\n.dark .ct-f5ee84{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"learning-about-processes","depth":2,"text":"Learning About Processes"},{"id":"todays-learning-goals","depth":2,"text":"Today's Learning Goals"},{"id":"plan-for-today","depth":2,"text":"Plan For Today","children":[{"id":"recap-threads-in-c","depth":3,"text":"Recap: Threads in C++"},{"id":"races-when-accessing-shared-data","depth":3,"text":"Races When Accessing Shared Data"},{"id":"introducing-mutexes","depth":3,"text":"Introducing Mutexes"}]}]}},"_type":"markdown","_id":"content:1.cpp:thread-mutex:threads-and-mutexes.md","_source":"content","_file":"1.cpp/thread-mutex/threads-and-mutexes.md","_extension":"md"}