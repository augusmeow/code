{"_path":"/notes/jenkins","_dir":"notes","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Jenkins","description":"","icon":"vscode-icons:file-type-jenkins","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"jenkins"},"children":[{"type":"text","value":"Jenkins"}]},{"type":"element","tag":"h2","props":{"id":"pipeline"},"children":[{"type":"text","value":"pipeline"}]},{"type":"element","tag":"h2","props":{"id":"matrix"},"children":[{"type":"element","tag":"a","props":{"href":"https://www.jenkins.io/doc/book/pipeline/syntax/#declarative-matrix","rel":["nofollow"]},"children":[{"type":"text","value":"matrix"}]}]},{"type":"element","tag":"code","props":{"code":"stage(\"compile-all\") {\n    when {\n        anyOf {\n            branch 'dev'\n            branch 'release'\n            branch 'master'\n        }\n    }\n    failFast false\n    \n    matrix {\n        axes {\n            axis {\n                name \"MODULE_NAME\"\n                values \"module1\", \"module2\"\n            }                 \n        }\n        stages {\n            stage(\"compile\") {\n                steps {\n                    container('docker') {\n                        echo \"build-${MODULE_NAME}\"\n                        script {}\n                    }\n                }\n            }\n        }\n    }\n}\n","language":"jenkinsfile","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"stage(\"compile-all\") {\n    when {\n        anyOf {\n            branch 'dev'\n            branch 'release'\n            branch 'master'\n        }\n    }\n    failFast false\n    \n    matrix {\n        axes {\n            axis {\n                name \"MODULE_NAME\"\n                values \"module1\", \"module2\"\n            }                 \n        }\n        stages {\n            stage(\"compile\") {\n                steps {\n                    container('docker') {\n                        echo \"build-${MODULE_NAME}\"\n                        script {}\n                    }\n                }\n            }\n        }\n    }\n}"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"use-method"},"children":[{"type":"text","value":"use method"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Jenkins pipeline 中，可以使用 Groovy 语言定义函数，然后在 pipeline 中调用该函数。定义函数的方式如下："}]},{"type":"element","tag":"code","props":{"code":"def myFunc(name) {\n    println \"Hello ${name}, welcome to Jenkins Pipeline!\"\n}\n","language":"groovy","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2938be"},"children":[{"type":"text","value":"myFunc"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0e909b"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-915d09"},"children":[{"type":"text","value":"println"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"\"Hello "}]},{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":", welcome to Jenkins Pipeline!\""}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然后可以在 pipeline 中调用该函数："}]},{"type":"element","tag":"code","props":{"code":"myFunc('John')\n","language":"groovy","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"myFunc("}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"'John'"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"也可以通过 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@Library"}]},{"type":"text","value":" 注解，将函数放入类中，然后在 pipeline 中调用："}]},{"type":"element","tag":"code","props":{"code":"@Library('my-lib@master')\nclass MyLib {\n    def myFunc(name) {\n        println \"Hello ${name}, welcome to Jenkins Pipeline!\"\n    }\n}\n\n// call the function\nMyLib.myFunc('John')\n","language":"groovy","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"@Library"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"'my-lib@master'"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0e909b"},"children":[{"type":"text","value":"MyLib"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-2938be"},"children":[{"type":"text","value":"myFunc"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-0e909b"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-915d09"},"children":[{"type":"text","value":"println"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"\"Hello "}]},{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":", welcome to Jenkins Pipeline!\""}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-62414c"},"children":[{"type":"text","value":"// call the function"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-ce9751"},"children":[{"type":"text","value":"MyLib."}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"myFunc("}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"'John'"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"curl"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"h4","props":{"id":"async-curl"},"children":[{"type":"text","value":"async curl"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Jenkins Pipeline 中使用 curl 异步发送 HTTP 请求非常容易。首先，您需要安装 curl 插件，然后使用sh 'curl'命令来发送请求。例如："}]},{"type":"element","tag":"code","props":{"code":"pipeline {\n    agent any\n    stages {\n        stage('Request') {\n            steps {\n                sh 'curl http://example.com'\n            }\n        }\n    }\n}\n","language":"jenkinsfile","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pipeline {\n    agent any\n    stages {\n        stage('Request') {\n            steps {\n                sh 'curl http://example.com'\n            }\n        }\n    }\n}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"另外，如果您需要在 Pipeline 中等待远程请求的响应，则可以利用 Jenkins 内置的 waitUntil 方法，如下所示："}]},{"type":"element","tag":"code","props":{"code":"pipeline {\n    agent any\n    stages {\n        stage('Request') {\n            steps {\n                script {\n                    def response = sh(returnStdout: true, script: 'curl http://example.com')\n                    waitUntil { response == 'expected response' }\n                }\n            }\n        }\n    }\n}\n","language":"jenkinsfile","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pipeline {\n    agent any\n    stages {\n        stage('Request') {\n            steps {\n                script {\n                    def response = sh(returnStdout: true, script: 'curl http://example.com')\n                    waitUntil { response == 'expected response' }\n                }\n            }\n        }\n    }\n}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"此外，您还可以使用 Jenkins 的 HTTP Request 插件，它提供了一种更加可靠和易于使用的方式来发送和管理 HTTP 请求，如下所示："}]},{"type":"element","tag":"code","props":{"code":"pipeline {\n    agent any\n    stages {\n        stage('Request') {\n            steps {\n                httpRequest url: 'http://example.com'\n            }\n        }\n    }\n}\n","language":"jenkinsfile","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"pipeline {\n    agent any\n    stages {\n        stage('Request') {\n            steps {\n                httpRequest url: 'http://example.com'\n            }\n        }\n    }\n}"}]}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"refer:"}]},{"type":"element","tag":"list","props":{},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.jenkins.io/doc/book/pipeline/docker/","rel":["nofollow"]},"children":[{"type":"text","value":"Using Docker with Pipeline"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.jenkins.io/doc/book/pipeline/jenkinsfile/","rel":["nofollow"]},"children":[{"type":"text","value":"Using a Jenkinsfile"}]}]}]}]},{"type":"element","tag":"code","props":{"code":"curl -d '{\"msgtype\": \"text\",\"text\": {\"content\":\"'\"$JOB_NAME\"': 镜像构建成功'\"${BASIN_IMAGE}, ${DEPS_IMAGE}\"'，已推送至镜像仓库\"}, \"at\": { \"atMobiles\": [\"'\"$OWNER_PHONE\"'\"] }}' \\ \n    -H 'Content-Type: application/json' \"$DINGTALK_URL\"\n","language":"bash","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0e909b"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-915d09"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"'{\"msgtype\": \"text\",\"text\": {\"content\":\"'\""}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"$JOB_NAME"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"\"': 镜像构建成功'\"${BASIN_IMAGE}, ${DEPS_IMAGE}\"'，已推送至镜像仓库\"}, \"at\": { \"atMobiles\": [\"'\""}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"$OWNER_PHONE"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"\"'\"] }}'"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-915d09"},"children":[{"type":"text","value":"\\ "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0e909b"},"children":[{"type":"text","value":"-H"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"'Content-Type: application/json'"}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"class":"ct-8ca7a0"},"children":[{"type":"text","value":"$DINGTALK_URL"}]},{"type":"element","tag":"span","props":{"class":"ct-c208ea"},"children":[{"type":"text","value":"\""}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-62414c{color:#6E7781}\n.ct-c208ea{color:#0A3069}\n.ct-915d09{color:#0550AE}\n.ct-0e909b{color:#953800}\n.ct-2938be{color:#8250DF}\n.ct-8ca7a0{color:#24292F}\n.ct-ce9751{color:#CF222E}\n.dark .ct-ce9751{color:#FF7B72}\n.dark .ct-8ca7a0{color:#C9D1D9}\n.dark .ct-2938be{color:#D2A8FF}\n.dark .ct-0e909b{color:#FFA657}\n.dark .ct-915d09{color:#79C0FF}\n.dark .ct-c208ea{color:#A5D6FF}\n.dark .ct-62414c{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"pipeline","depth":2,"text":"pipeline"},{"id":"matrix","depth":2,"text":"matrix","children":[{"id":"use-method","depth":3,"text":"use method"},{"id":"curl","depth":3,"text":"curl"}]}]}},"_type":"markdown","_id":"content:5.notes:Jenkins.md","_source":"content","_file":"5.notes/Jenkins.md","_extension":"md"}