{"_path":"/code/db/mongodb","_dir":"db","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"mongoDB使用记录","description":"","date":"2021-08-19T10:23:13.000Z","category":["编程"],"tag":["mongoDB"],"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"mongodb使用记录"},"children":[{"type":"text","value":"mongoDB使用记录"}]},{"type":"element","tag":"h2","props":{"id":"切换数据库"},"children":[{"type":"text","value":"切换数据库"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"use test_augus"}]},{"type":"text","value":"如果数据库不存在会自动创建 test_augus"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"show dbs"}]},{"type":"text","value":" 查看所有数据库"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"新建数据库必须插入数据才会显示在列表中 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_augus.insert({\"name\":\"augus\"})"}]}]},{"type":"element","tag":"h2","props":{"id":"user-op"},"children":[{"type":"text","value":"user op"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"show users"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.createUser({user: \"ssss\",pwd: \"oracle\", roles: [ { role: \"root\", db: \"admin\" } ]})"}]}]},{"type":"element","tag":"h2","props":{"id":"find"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db[\"test_sensitive_0\"].find()"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_sensitive_0.find().count();"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_sensitive_0.find()"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.getSiblingDB(\"test_ddl\").getCollection(\"test_xyz\").find({ })"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.getCollection(\"test_xyz\").find({}).limit(88)"}]}]},{"type":"element","tag":"h2","props":{"id":"distinct"},"children":[{"type":"text","value":"distinct"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db[\"test_sensitive_0\"].distinct('name')"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_xyz.distinct(\"name\",{\"age\":20})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.revokeRolesFromUser( \"mongoTestAdmin\", [ { role: \"read\", db: \"admin\" }, \"readWrite\" ], { w: \"majority\" } )"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.updateUser( \"root\",{pwd: \"oracle\", roles: [ { role: \"read\", db: \"test1\" } ]})"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.updateUser('root',{pwd:'633636',roles:[{role:'read',db:'springbucks'}]})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_sensitive_0.updateOne( { type: \"book\", item : \"journal\" }, { $set : { qty: 10 } }, { upsert :true } )"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.changeUserPassword(\"root\",\"gag\");"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.dropUser(\"ssss\")"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_xyz.aggregate([{$group : {_id : \"$by_user\", num_tutorial : {$sum : 1}}}])"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_xyz.insertOne({_id:\"faf\",id:\"af\",age:\"21\",gender:\"male\",name:\"gag\"})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_sensitive_0.updateOne( { type: \"book\", item : \"journal\" }, { $set : { qty: 10 } }, { upsert :true } )"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_sensitive_0.deleteOne({'name':'James'})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_xyz.insert( { _id: 14, type: \"misc\", item: \"card\", qty: 15 } )"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"show collections"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.createCollection(\"afafaff\", { capped : true, size : 5242880, max : 5000 } )"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.log.drop()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.createView(   \"firstView\",  \"demo113\",  [ { $project: { \"Name\": \"$Details.Name\", Subject: 1 } } ])"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.test_xyz.createIndex({'age':22})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.log.drop()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"show dbs db"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"use augus_drop db.augus_drop.insertOne({_id:1,name:\"test\"})"}]},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.dropDatabase()"}]}]},{"type":"element","tag":"code","props":{"code":"use test1 db.createRole(\n{ role: \"afafa\", privileges: [\n{ resource: { cluster: true }, actions: [ \"addShard\" ] }, { resource: { db: \"config\", collection: \"\" }, actions: [ \"find\", \"update\", \"insert\", \"remove\" ] }, { resource: { db: \"users\", collection: \"usersCollection\" }, actions: [ \"update\", \"insert\", \"remove\" ] }, { resource: { db: \"\", collection: \"\" }, actions: [ \"find\" ] }\n], roles: [\n{ role: \"read\", db: \"test1\" }\n]\n}, { w: \"majority\" , wtimeout: 5000 }\n)\n","language":"sql","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" test1 "}]},{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"db"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"createRole"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"{ "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"role"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"afafa\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":", privileges: ["}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"{ "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"resource"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": { cluster: true }, actions: [ \"addShard\" ] }, { "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"resource"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": { db: "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"config\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"collection"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" }, actions: [ \"find\", \"update\", \"insert\", \"remove\" ] }, { "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"resource"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": { db: "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"users\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"collection"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"usersCollection\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" }, actions: [ \"update\", \"insert\", \"remove\" ] }, { "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"resource"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": { db: "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"collection"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" }, actions: [ \"find\" ] }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"], roles: ["}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"{ "}]},{"type":"element","tag":"span","props":{"class":"ct-7a67f9"},"children":[{"type":"text","value":"role"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"read\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":", db: "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"test1\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"]"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"}, { w: "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"majority\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" , wtimeout: "}]},{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"use test db.dropRole( \"readWrite\" )"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.createRole()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"use admin db.createRole({role:\"mongostatMangeRole1\",privileges:[{resource:{cluster:true},actions:[\"serverStatus\"]}]})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.createRole({role:\"bigRole1\",privileges:[{resource:{anyResource:true},actions:[\"anyAction\"]}],roles:[]})"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.dropRole(\"bigRole1\")"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"db.grantRolesToUser(\"mongoTestAdmin\", [{role:\"readWrite\", db:\"admin\"}])"}]}]},{"type":"element","tag":"code","props":{"code":"db.grantRolesToRole(\n\"mongoTestAdmin\",\n[ \"write\" ],\n)\n","language":"sql","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"db"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"grantRolesToRole"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"mongoTestAdmin\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"[ \"write\" ],"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"db.grantRolesToRole(\n\"mongoTestAdmin\",\n[ \"productsReader\" ], { w: \"majority\" , wtimeout: 5000 }\n)\n","language":"sql","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"db"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"grantRolesToRole"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"mongoTestAdmin\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":"[ \"productsReader\" ], { w: "}]},{"type":"element","tag":"span","props":{"class":"ct-6743e0"},"children":[{"type":"text","value":"\"majority\""}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" , wtimeout: "}]},{"type":"element","tag":"span","props":{"class":"ct-b6a9c0"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":" }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8a699d"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-6743e0{color:#0A3069}\n.ct-b6a9c0{color:#0550AE}\n.ct-8a699d{color:#24292F}\n.ct-7a67f9{color:#CF222E}\n.dark .ct-7a67f9{color:#FF7B72}\n.dark .ct-8a699d{color:#C9D1D9}\n.dark .ct-b6a9c0{color:#79C0FF}\n.dark .ct-6743e0{color:#A5D6FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"切换数据库","depth":2,"text":"切换数据库"},{"id":"user-op","depth":2,"text":"user op"},{"id":"find","depth":2,"text":"find"},{"id":"distinct","depth":2,"text":"distinct"}]}},"_type":"markdown","_id":"content:3.code:db:mongoDB.md","_source":"content","_file":"3.code/db/mongoDB.md","_extension":"md"}